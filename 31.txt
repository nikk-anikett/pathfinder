import React, { useState, useEffect } from "react";
import axios from "axios";

function App() {
  const [data, setData] = useState([]);
  const [currentDatabase, setCurrentDatabase] = useState("database1"); // Track the current database

  const fetchData = async (database) => {
    try {
      const response = await axios.get(`http://localhost:8000/${database}`);
      const data = response.data;
      setData(data);
    } catch (error) {
      console.log(error);
    }
  };

  useEffect(() => {
    fetchData(currentDatabase); // Fetch data based on the currentDatabase state
    const interval = setInterval(() => {
      fetchData(currentDatabase);
    }, 5000);

    return () => clearInterval(interval);
  }, [currentDatabase]); // Re-run the effect when the currentDatabase changes

  // Function to switch between databases
  const switchDatabase = () => {
    const newDatabase = currentDatabase === "database1" ? "database2" : "database1";
    setCurrentDatabase(newDatabase);
  };

  return (
    <div className="App">
      <button onClick={switchDatabase}>Switch Database</button>
      <div>
        <table border="1">
          <tbody>
            {data.map((row) => (
              <tr key={row.ClientName}>
                <td>{row.ClientName}</td>
                {/* Render other fields */}
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

export default App;
var checkManual = true;
fetchData('database1');


//////////
// Perform operation in Manual

function btnFunc_for_Manual() {
  let currentDatabase = 'database1';
  if (checkManual == true) {
    fetchData('database2');
    document.getElementById('myBtn').innerHTML = 'Manual ON';
    checkManual = false;
  } else {
    fetchData('database1');
    document.getElementById('myBtn').innerHTML = 'Manual OFF';
    checkManual = true;
  }
}



function updateTable(data) {
  var i = 1;
  const tableBody = document.getElementById('data');
  let tableHTML = '';
  var playSound = false;
  data.forEach((row) => {

  
    tableHTML += `<tr>
                    <td>${row.ClientName}</td>
                    <td>${row.Symbol}</td>
                    <td>${row.Expirydate}</td>
                    <td>${row.Qty_Short}</td>
                    <td>${row.Qty_Net}</td>
                    <td>${row.Qt_Intra}</td>
                    <td>${row.Qt_Carry}</td>
                  </tr>`;
  });

  tableBody.innerHTML = tableHTML;
}



////
// Fetching the data from Server 


function fetchData(database) {
  currentDatabase = database;
  const xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 && xhr.status === 200) {
      const data = JSON.parse(xhr.responseText);
      updateTable(data);
    }
  };
  xhr.open('GET', `/${database}`, true);
  xhr.send();
}





/////
// Fetch data initially and refresh every 2 seconds

fetchData(currentDatabase);
setInterval(() => {
  fetchData(currentDatabase);
}, 2000); // 2000 milliseconds = 2 seconds 



////
//Show table on Web Page 

showTableButton.addEventListener("click", function () {
  dataTable.style.display = "table"; // Show the table
  fetchData(currentDatabase); // Fetch data and update the table
});

var checkManual = true;
var currentDatabase = localStorage.getItem('currentDatabase') || 'database1';

function btnFunc_for_Manual() {
  if (checkManual) {
    currentDatabase = 'database2';
    document.getElementById('myBtn').innerHTML = 'Manual ON';
    checkManual = false;
  } else {
    currentDatabase = 'database1';
    document.getElementById('myBtn').innerHTML = 'Manual OFF';
    checkManual = true;
  }
  
  localStorage.setItem('currentDatabase', currentDatabase);
  fetchData(currentDatabase);
}

// Initialize the button text based on the currentDatabase
document.getElementById('myBtn').innerHTML = checkManual ? 'Manual OFF' : 'Manual ON';

// Initialize and fetch data based on the currentDatabase
fetchData(currentDatabase);


